<!DOCTYPE html>
<html>
  <head>
    <title>Territory App - Gesti√≥n de Territorios</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <% if user_signed_in? %>
      <!-- Navbar para usuarios autenticados -->
      <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
          <a class="navbar-brand" href="<%= root_path %>">
            üó∫Ô∏è Territory App
          </a>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  üë§ <%= current_user.name %>
                  <% if current_user.admin? %>
                    <span class="badge bg-danger">Admin</span>
                  <% end %>
                </a>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                  <li>
                    <a class="dropdown-item" href="#">
                      <small class="text-muted">
                        üìß <%= current_user.email %><br>
                        üèõÔ∏è <%= current_user.congregation&.name || 'Sin congregaci√≥n' %><br>
                        üìç <%= current_user.city || 'Sin ciudad' %>
                      </small>
                    </a>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <% if current_user.admin? %>
                    <li>
                      <a class="dropdown-item" href="#">
                        ‚öôÔ∏è Panel Admin
                      </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                  <% end %>
                  <li>
                    <%= link_to 'üö™ Cerrar Sesi√≥n', destroy_user_session_path, 
                        method: :delete, 
                        data: { turbo_method: :delete },
                        class: 'dropdown-item text-danger' %>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    <% end %>

    <!-- Flash messages -->
    <% if notice.present? || alert.present? %>
      <div class="container mt-3">
        <% if notice %>
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <%= notice %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% end %>
        <% if alert %>
          <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <%= alert %>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        <% end %>
      </div>
    <% end %>

    <%= yield %>
  </body>
</html>
